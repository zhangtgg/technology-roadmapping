# 家用路由器

> 为什么要单独讲一讲家用路由器呢？因为家用路由器与普遍意义上的路由器是有一定区别的，这会导致小白在学习计算机网络体系知识的时候，在路由器这一块产生非常多的困惑，感觉书本上解释的与家用的路由器有很多地方不一样！而这也是这篇文章的目的，分别从几个角度解释家用路由器。

## 家里为什么需要路由器？

当年大部分人家里联网的设备只有一台电脑主机，也没有连接 WiFi 的需求，所有直接使用电脑连接 Modem（猫）拨号就可以了，整个网络由一台电脑主机独享。现在已经是每个家庭里面需要联网的设备少则两三台，多则十多台，甚至还有不少智能家居设备需要连接 WiFi 网络。这种情况下就需要使用路由器分享有线和 WiFi 网络才可以让这么多设备连接网络。

虽然说现在光猫附带了光转电、拨号、路由、防火墙、AP 和 LAN 接口等功能（更别说很多光猫不支持 AP、LAN 接口少、只有一个千兆 LAN 等功能）

但是说到底专业的设备做专业的事情。

我就是光猫只负责光转电，其他功能由性能强大的路由器负责，如果路由器接口不够可以接一个交换机增加 LAN 接口。

## 计算机网络中的路由器与家里用的路由器是一个概念么？

先来看看企业局域网的一般结构：
PC … AP -- Switch -- Firewall -- Router -- Internet
| -- DHCP Server
| -- DNS Server
l -- Radius Server

AP 无线接入点，负责将 PC 接入局域网，但总得认证一下吧？一般基于 802.1x 认证，Switch 把 PC 的用户名/密码传到 Radius Server 做认证，认证成功，则允许访问。

家庭无线路由器也具有以上功能，只是使用密码来认证用户设备。

Switch 负责将所有设备连接起来，并提供 VLAN 功能。

家庭无线路由器一般提供 4 个 LAN 口，就是一个 4 口交换机，一般没有 VLAN 功能。

DHCP 服务器给用户分配私网IP、缺省网关、DNS服务器等上网必要参数，这时用户设备才算连上网了。

家庭无线路由器也提供以上功能。

用户浏览网页，浏览器会联系 DNS 服务器来将网址转换成 lP。

家庭无线路由器也提供 DNS 服务器功能。

Firewall 可以阻止 Internet 访问局域网，还可以禁止内部用户访问特定网站。

家庭无线路由器也提供以上功能，一般只是基于 MAC/IP 的过滤。

当访问 Internet 的流量到达 Router 时，路由器会根据 NAT 策略，会做 NAT（IP地址转换），然后发到 Internet。

如果流量是访问公司 WAN（基于路由表），则不需要 NAT，直接发到 WAN 线路。

家庭无线路由器提供自动 NAT（无法配置，因为没有配置页面），将私网 IP 转换为 PPP 拨号分配的 lP。

综述：家庭无线路由器集成了 AP + Switch + Firewall + Router 的功能，是多面手！

---

家用路由器一般是无线接入点 + PPPoE 客户端 + DHCP 服务器 + DNS 代理服务器 + NAT 网关 + 防火墙 + WebUI 的的集合体，一般计算机网络中说的路由器只负责路由（决定哪里收的数据包要发到哪里，要不要扔掉），其他的由专门的设备来另外处理。

其实不一样，家用路由器一般只是个 NAT 网关 + DHCP 服务器，后头接个交换机和无线 AP。虽说可以配置成关闭 NAT 靠路由转发，但一般不这么用，所以和传统的路由器完全是两回事。

---

“家用路由器” 和书上讲的 “路由器” 完全不是一个概念！如果仅仅从功能上来说，路由器 = 交换机 + NAT。以下 “家用路由器” 专指家用路由器，而 ”路由器“ 专指书上讲的路由器。

路由器是工作在网络层的设备，交换机是工作在数据链路层的设备，因此路由器比交换机更高一层，正是因为高了一层，所以才能实现 NAT 这种功能。

一台家用路由器由一个 CPU 担任网关的角色，一个端口创建一个局域网地址池，连接到交换机芯片上分给四个局域网端口，另一端口接广域网口，与局端设备保持连接，获得一个公网 IP（目前运营商大内网环境下，依旧还是一个内网 IP）。至于无线芯片，其实是连在交换机芯片上的。所以家用无线路由器严格来说产品名称应该是家庭网关。

## 家庭路由器既是网关又是交换机？

家里的路由器通常也充当网关的角色，这毋庸置疑。

关键在于是否有交换机功能？通过路由器可视化界面，可以查看各口的 ip 地址以及 ip 和 Mac 地址的映射表。这是可以看到，不管终端通过 LAN 口还是无线连接路由器，终端地址都在限定地址池随机产生，地址池内所有地址处于同一网段。路由器 WAN 口 ip 地址则在另一网段。假设路由器只有路由器功能，那么，所有接口 ip 地址必须在不同网段。然而 LAN 口和无线网络中的 ip 地址均在同一网段的地址池中，恰恰证明了家用路由器 LAN 口和无线网络实现了交换机功能，如果我们舍弃 WAN 口，只使用 LAN 那么家用路由器就是一台交换机。所以，家用路由器是实际是交换机和路由器的集成。

交换机的基本功能是扩展端口，路由器有一个 WAN 口与 4 个 LAN 口。那 4 个 LAN 口就相当与一个 4 口的交换机。

家用路由器有交换机的功能，通过以下方法可以把路由器当做普通交换机使用：

1、首先先用正常路由器模式，打开路由器的设置界面，把无线路由器的 DHCP 服务关掉。

2、重启路由器，把需要连接的电脑的网线插到无线路由器的 LAN 口，不使用 WAN 口。

3、电脑、手机搜索无线网络，正常连接，当然台式机也可以用网线连接 LAN 口当作有线交换机。

4、每台机子上相应的网卡的 IP 设置与使用普通交换机的设置在同一个网段。

## 家用的无线路由器和广域网上的路由器有什么区别？

**一、广域网路由与家用无线路由在概念和功能上的区别**

广域网上的路由器其实也就是核心路由器，又被称为“骨干路由器”，是位于网络中心的；而我们家用的[无线路由](https://www.zhihu.com/search?q=无线路由&search_source=Entity&hybrid_search_source=Entity&hybrid_search_extra={"sourceType"%3A"answer"%2C"sourceId"%3A1321759181})是位于网络边缘的边缘路由器，也叫接入路由器。

核心路由器通常都是三层交换机，也就是带有路由功能的交换机，主要用于高速的数据分组选路和转发，因此其功能较为单一，不具备 NAT 功能，并且要求使用全硬件的转发方式。但核心路由器在性能上很强，CPU 主频和内存都比较高，数据处理的速度快，相较于边缘路由器具有较大的吞吐量，并且支持的网络类型也多。

家用无线路由实际上也就是增加了 NAT 功能的交换机。可以这么理解：家用路由器 = 虚拟拨号 + NAT共享网关 + DHCP + 二层交换机 + 无线交换机。

家用无线路由比较注重丰富的过滤和安全功能，因此它在 ACL 和 NAT 及防火墙这些功能上很强，使得内网中的设备可以访问公网，但公网设备是不能主动访问内网的，这种单向访问在很大程度上保护了内网。不过，家用无线路由有个缺点就是性能一般，带机量并不高。

此外，核心路由器与边缘路由器其实是两个相对的概念，某一层的核心路由器或许就是上一层的边缘路由器。

**二、交换机、有线路由器和无线路由器的区别**

这里还需要区分一下交换机、有线路由和无线路由的概念。

有线路由相比无线路由主要的区别的确就是端口较多，能为更多的设备提供更稳定且高效的有线连接，无线路由主要用作家用，而有线路由则广泛运用于企业。

但交换机与家用无线路由的区别远不止如此。区别如下：

（注意：下面所讲的是简单的交换机，区别于上面所讲的带有路由功能的三层交换机）

1、交换机的本质就是一种开关，是一种用于电信号或光信号转发的网络设备，可以为接入的几个网络节点提供独享的电信号通路。交换机是做端口扩展的，通过扩大局域网的接入点，能让更多的设备接入；但路由器只是用来做网间连接的，也就是用来连接不同的网络；

2、路由器可以给局域网自动分配IP，但交换机只是用来分配网络数据的；

3、二者所处的层次不同，路由器位于网络层，可以根据 IP 地址寻址，可以处理 TCP/IP 协议，但交换机不可以。交换机在中继层，根据 MAC 地址寻址；

4、路由器可以把一个 IP 分配给很多个主机使用，这些主机对外只表现出一个 IP。交换机可以把很多主机连起来，这些主机对外各有各的 IP；

5、打个比方吧，路由器相当于邮局，把信投递到收件人地址，任务就完成了。但是信邮到了宿舍楼，而这个地址不是某人专享的，所以楼管还要负责把信给到收件人手里，他不会关心收件人地址，只看收件人姓名，然后打个内线电话通知取信。

如果没有邮局，就无法向外界发送信件，也无法获取到外界的信件。但是因为楼管的存在，仍然可以通过他与同宿舍楼的好友书信往来。所有邮局构成的系统，就是“广域网”，而宿舍楼，就是“局域网”，构建局域网是不需要路由器的。

## 家用无线路由器的WAN口与LAN口之间到底是什么关系？

现在一般家庭上网采用 ADSL 电话线上网的较多，而且家里一般都有好几台电脑，那么如何使几台电脑同时上网呢？这就要用到宽带路由器了，一般情况下宽带路由器上面有好几个网线插口，这些网线插口上有的标有 WAN，有的网口标有 LAN，WAN 口和 LAN 口的区别是什么?请接着往下看。

一、宽带路由器上路由器 WAN 口和 LAN 口的区别

从它们的名称上我们就不难看出，WAN 口主要用于连接外部网络，如 ADSL、DDN、以太网等各种接入线路；而 LAN 口用来连接家庭内部网络，主要与家庭网络中的交换机、集线器或 PC 相连。可以说这两类网口一类对外，一类对内。

首先将网络运营商提供的接入网线插在 WAN 口上，然后将几台共享上网的电脑接到 LAN 口上，然后用一台电脑登录路由器的管理界面进行相应的配置即可完成共享上网了。

二、网络数据在 WAN 口和 LAN 口的传输过程

当家庭网络中的机器向外部网络发送数据包的时候，首先发送一个请求到默认网关，也就是发送到宽带路由器。路由器在分析该数据包中的内网 IP 地址时会检查设备本身的 NAT 地址转换表。在找到相应的条目后，就会利用 WAN 口 IP 地址去与外部网络进行通信。

外部网络接收到数据包后，会解析出数据包中的路由器的 WAN 口 IP 地址，并对该地址进行响应，将响应数据包发送到路由器。然后路由器再次进行 NAT 地址转换，将 WAN 口 IP 地址转换为发送请求的内网 IP 地址，最终完成整个数据包的发送和接收过程。

---

路由器的作用类似双端口（WAN 和 LAN 口）网关，LAN 口和 WAN 口分别连着两个自治系统（可简单理解为两个不同网段的局域网），早期 WAN 和 LAN 口没有太多功能上的区分，每个口都有各自的 MAC 地址和 IP 地址，后来为了满足用户能把多个主机接到一个路由上，并把多个主机的数据同时通过某一个接口统一发送到其他网络上，于是把其中一个口进行了扩展成多个口以便连接多台主机，这些被扩展出的口就叫 LAN 口，而负责将数据统一发送到其他网络的口则叫 WAN 口。所以 LAN 口有多个，WAN 只有一个。

这些 LAN 口之间在早期路由上采用集线器扩展出来，但集线器属于物理上串联在一起，当 LAN 口多个主机同时发送数据会造成冲突，形成冲突域，需要主机采用介质访问控制算法进行处理，比较麻烦还影响传输速度。于是后来慢慢采用多口网桥代替集线器将多个 LAN 口连接，这种连接的本质就是交换机，它隔绝了数据冲突的问题。所以现在的路由器 LAN 口可以单独当做交换机使用。

而 WAN 口一直只是一个口，它负责将 LAN 口所有主机的数据报按照路由表有序的发送到下一个路由节点或者主机。

总结一下：LAN 口将各个网络设备的数据收集后由 WAN 口发送到外网相邻节点。WAN 口接受到外网的数据后按照路由表分发到 LAN 口连接的各个主机。

---

随着家庭中需要上网的电脑的增多，很多家庭选择了借助于宽带路由器来实现共享上网，然而由于对网络知识缺乏了解，很多用户在购买了宽带路由器后，发现有的网口标有 WAN，有的网口标有 LAN，这两种网口各自是干什么用的？两者什么分别？如何更好的运用它们？让很多朋友犯了愁，本文将和大家来一起了解宽带路由器上这两种类型的网络端口的分别和一些新玩法。

一、了解 WAN 口与 LAN 口的分别

熟悉网络的朋友都知道 WAN 是英文 Wide Area Network 的首字母所写，即代表广域网；而 LAN 则是 Local Area Network 的所写，即本地网（或叫局域网）。那么我们不妨给路由器上的 WAN 口和 LAN 口取一个中文名称，分别是广域网端口和本地网端口。

多 WAN 口宽带路由器保障网络接入

除了在带宽上得到提升之外，大多数多 WAN 口路由器还支持全自动负载均衡与实时备份，并可根据源或目的地址指定优先通道，问题时流量自动重分配等功能。

利用多 WAN 口宽带路由器可以基本上避免因网络运营商造成的网络中断。虽然购买多 WAN 口路由器和增加网络接入线路会造成投资上的增多，但是对于股民朋友们来说，所得到保障是远远大于付出的。

三、把宽带路由器当交换机用

除了常规的 WAN 口接外网入户线、LAN 口接内网计算机的常规用法外，我们也可以把把入户线和接计算机的网线都连接在 LAN 口上，把宽带路由器当交换机用。

宽带路由器当交换机用

这种连接方式有几个值得注重的事项，首先需要你的宽带路由器的 LAN 口或上联的设备网口支持端口翻转（Auto MDI/MDIX）功能，否则的话，你可能需要将你的直连线改为交叉线，才能使你的宽带路由器能通过 LAN 口连接到外部网络中。

其次，运用这种方式就丧失了宽带路由器的路由功能，因此要实现共享上网的话，需要你的家庭网络中的计算机运用你的运营商网络中的合法 IP 地址。同时，为了保持对路由器的可访问，要将路由器的 LAN 口的 IP 地址也设为合法的运营商的地址。

## 家用路由器默认开启NET了吗？

目前绝大部分的家用路由器都自动开启 NAT 模式（部分默认且无法更改），如果可以选择建议用户开启 NAT 模式。简单来说，路由器中的 NAT 模式的作用就是把局域网中的内网地址转换成合法的公网地址。下面是对目前主流路由器的两种模式的具体说明：

1、NAT 模式：局域网采用了私网地址，私网地址可以在不同的局域网重复使用，但是不能出现在互联网。如果访问互联网需要经过 NAT 地址转换，将内网地址映射成为一个公网可以使用的地址（WAN 端口获取的地址）。

2、路由模式：局域网采用了在互联网上可以使用的合法地址，实现不同网段的主机通过路由的方式进行相互通信，核心是一张路由表，记录了三个要素：目标网络，下一跳地址、出口接口。

## WAN口IP地址和LAN口IP地址不能处于同一子网

由于家用路由器开启了 NET 协议，即：LAN 口进入的 IP 及端口会由 WAN 口的 IP 进行代理转发，如果 WAN 口与 LAN 口的 IP 是同一子网的，那么当 WAN 收到外网的 IP 后就不知道这个 IP 是属于自己的，还是要转换后给 LAN 那边的，因为大家都是一个子网中的，根本无法区分。
